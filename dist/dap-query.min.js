!function(){"use strict";!function(e){var n="undefined"!=typeof window?window:global,t=Object.prototype.hasOwnProperty.call(n,e),r=n[e],a=n[e]={};"undefined"!=typeof module&&module.exports&&(module.exports=a),a.noConflict=function(){if(n[e]===a&&(n[e]=t?r:void 0,!t))try{delete n[e]}catch(i){}return a};var i=function(e){Object.keys(e.variables).forEach(function(n){var t=e.variables[n];if(t.units&&!(t.units.indexOf("days since ")<0&&t.units.indexOf("seconds since ")<0)){t.scale=t.units.split(" ")[0];var r=t.units.substr(t.scale.length+7),a=r.split(/[ \-\:]/);t.epoch=new Date(a[0],a[1]-1,a[2],a[3]||null,a[4]||null,a[5]||null)}})};a.dasToJSON=function(e){e="{\n"+e+"\n}";var n,t=e.split("\n"),r=[];t.forEach(function(e){var t=(e.match(/[^\\]"/g)||[]).length;n?t%2?(r.push(n+e),n=void 0):n+=e:t%2?n=e:r.push(e)}),n&&r.push(n),r=r.map(Function.prototype.call,String.prototype.trim);var a=function(e){if(e===r.length-1)return!0;for(var n=e+1;n<r.length;n++){if("}"===r[n])return!0;if(r[n].length)return!1}return!0};r=r.map(function(e,n){if(!e.length)return"";if("{"===e)return"{";if("}"===e[0])return a(n)?"}":"},";var t;if("{"===e[e.length-1])return t=e.split(" "),'"'+t[0]+'":{';t=e.split(" ");var r=t[0],i=t[1],l=r.length+i.length+2,u=e.substr(l,e.length-l-1);"String"!==r&&u.indexOf(",")>=0&&(u="["+u+"]"),"NaN"===u&&(u="null");var o='"'+i+'":'+u;return a(n)||(o+=","),o});var i=r.join("\n");return i},a.parseDAS=function(e){var n={variables:{}},t=a.dasToJSON(e),r=JSON.parse(t).Attributes;for(var l in r)"NC_GLOBAL"===l?n.attr=r[l]:n.variables[l]=r[l];return i(n),n};var l=function(e,n){for(var t in e)n[t]=e[t];return n},u=function(e){for(var n={},t=e.getElementsByTagName("Attribute"),r=0;r<t.length;r++){var a=t[r],i=a.getElementsByTagName("value")[0].textContent;n[a.getAttribute("name")]=i}return n},o=function(e){var n={};n.dimensions=[],n=l(u(e),n);for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];"Attribute"!==r.nodeName&&"#text"!==r.nodeName&&("dimension"===r.nodeName?n.dimensions.push({name:r.getAttribute("name"),size:r.getAttribute("size")}):n.dType=r.nodeName)}return n};a.parseDDX=function(e){var n=new DOMParser,t=n.parseFromString(e,"text/xml");t=t.documentElement;var r,a,s,f={variables:{}},c=t.getElementsByTagName("Grid");for(r=0;r<c.length;r++){var v=c[r];a=v.getAttribute("name"),s={},s=l(u(v),s);var p=v.getElementsByTagName("Array")[0];s=l(o(p),s),f.variables[a]=s}var m=t.getElementsByTagName("Array");for(r=0;r<m.length;r++){var g=m[r];"Grid"!==g.parentNode.nodeName&&(a=g.getAttribute("name"),f.variables[a]=o(g))}return i(f),f};var s=function(e,n){if(1===n.length)return"["+e[0]+"]";if(2===n.length)return"["+e.map(function(e){var n=e.split(",");return"["===n[0][0]&&n.shift(),"["+n.join(",")+"]"}).join(",\n")+"]\n";for(var t=[],r=0;r<n[0];r++){var a=s(e.slice(r,r+n[1]),n.slice(1));r<n[0]-1&&(a+=","),a+="\n",t.push(a)}return"["+t.join("").replace(/NaN/g,"null")+"]"};return a.dataToJSON=function(e){var n=e.split(/\n-+\w*\n/),t=(n[0],n[1]),r=t.trim().split("\n\n");return r=r.map(function(e){var n=e.split("\n"),t=n.shift(),r=t.split("["),a=r.shift().split(".").pop();r=r.map(function(e){return+e.slice(0,e.length-1)});var i=s(n,r);return'"'+a+'":'+i}),"{"+r.join(",\n")+"}"},a.parseData=function(e,n,t){var r=JSON.parse(a.dataToJSON(e));if(n&&Object.keys(r).forEach(function(e){if(n.variables[e]){var t=n.variables[e];if(t.epoch){var a=t.epoch;r[e]=r[e].map(function(e){if("days"===t.scale){var n=new Date(a);return n.setDate(n.getDate()+e),n}return"seconds"===t.scale?new Date(a.getTime()+1e3*e):null})}}}),n)for(var i in r)void 0!==t&&void 0!==t[i]?a.replaceValues(r[i],t[i],0/0):n.variables[i]&&n.variables[i]._FillValue&&a.replaceValues(r[i],+n.variables[i]._FillValue,0/0);return r},a.replaceValues=function(e,n,t){for(var r in e)null===e[r]&&(e[r]=0/0),e[r].length?a.replaceValues(e[r],n,t):e[r]===n&&(e[r]=t)},a.simplifyVariable=function(e){return"[object Array]"===Object.prototype.toString.call(e)?1===e.length?a.simplifyVariable(e[0]):e.map(function(e){return a.simplifyVariable(e)}):e},a.simplify=function(e){var n={};for(var t in e)n[t]=a.simplifyVariable(e[t]);return n},a.sliceToQuery=function(e){return e.length||(e=[e]),1===e.length&&(e=[e,e]),2===e.length&&(e=[e[0],1,e[1]]),"["+e.join(":")+"]"},a.makeQuery=function(e,n,t){t=t||{};var r=e.variables[n];return r.dimensions.map(function(e){var n=e.name,r=t[n];return void 0===r&&(r=[0,+e.size-1]),a.sliceToQuery(r)}).join("")},a}("dap")}();