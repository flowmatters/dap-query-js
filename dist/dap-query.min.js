!function(){"use strict";!function(e){var t="undefined"!=typeof window?window:global,n=Object.prototype.hasOwnProperty.call(t,e),r=t[e],a=t[e]={};"undefined"!=typeof module&&module.exports&&(module.exports=a),a.noConflict=function(){if(t[e]===a&&(t[e]=n?r:void 0,!n))try{delete t[e]}catch(i){}return a};var i=function(e){Object.keys(e.variables).forEach(function(t){var n=e.variables[t];if(n.units&&!(n.units.indexOf("days since ")<0&&n.units.indexOf("seconds since ")<0)){n.scale=n.units.split(" ")[0];var r=n.units.substr(n.scale.length+7),a=r.split(/[ \-\:]/);n.epoch=new Date(a[0],a[1]-1,a[2],a[3]||null,a[4]||null,a[5]||null)}})};a.dasToJSON=function(e){e="{\n"+e+"\n}";var t,n=e.split("\n"),r=[];n.forEach(function(e){var n=(e.match(/"/g)||[]).length;t?n%2?(r.push(t+e),t=void 0):t+=e:n%2?t=e:r.push(e)}),t&&r.push(t),r=r.map(Function.prototype.call,String.prototype.trim);var a=function(e){if(e===r.length-1)return!0;for(var t=e+1;t<r.length;t++){if("}"===r[t])return!0;if(r[t].length)return!1}return!0};r=r.map(function(e,t){if(!e.length)return"";if("{"===e)return"{";if("}"===e[0])return a(t)?"}":"},";var n;if("{"===e[e.length-1])return n=e.split(" "),'"'+n[0]+'":{';n=e.split(" ");var r=n[0],i=n[1],l=r.length+i.length+2,u=e.substr(l,e.length-l-1);"String"!==r&&u.indexOf(",")>=0&&(u="["+u+"]"),"NaN"===u&&(u="null");var o='"'+i+'":'+u;return a(t)||(o+=","),o});var i=r.join("\n");return i},a.parseDAS=function(e){var t={variables:{}},n=a.dasToJSON(e),r=JSON.parse(n).Attributes;for(var l in r)"NC_GLOBAL"===l?t.attr=r[l]:t.variables[l]=r[l];return i(t),t};var l=function(e,t){for(var n in e)t[n]=e[n];return t},u=function(e){for(var t={},n=e.getElementsByTagName("Attribute"),r=0;r<n.length;r++){var a=n[r],i=a.getElementsByTagName("value")[0].textContent;t[a.getAttribute("name")]=i}return t},o=function(e){var t={};t.dimensions=[],t=l(u(e),t);for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];"Attribute"!==r.nodeName&&"#text"!==r.nodeName&&("dimension"===r.nodeName?t.dimensions.push({name:r.getAttribute("name"),size:r.getAttribute("size")}):t.dType=r.nodeName)}return t};a.parseDDX=function(e){var t=new DOMParser,n=t.parseFromString(e,"text/xml");n=n.documentElement;var r,a,s,f={variables:{}},c=n.getElementsByTagName("Grid");for(r=0;r<c.length;r++){var v=c[r];a=v.getAttribute("name"),s={},s=l(u(v),s);var p=v.getElementsByTagName("Array")[0];s=l(o(p),s),f.variables[a]=s}var m=n.getElementsByTagName("Array");for(r=0;r<m.length;r++){var g=m[r];"Grid"!==g.parentNode.nodeName&&(a=g.getAttribute("name"),f.variables[a]=o(g))}return i(f),f};var s=function(e,t){if(1===t.length)return"["+e[0]+"]";if(2===t.length)return"["+e.splice(0,t[0]).map(function(e){var t=e.split(",");return"["===t[0][0]&&t.shift(),"["+t.join(",")+"]"}).join(",\n")+"]\n";for(var n="",r=0;r<t[0];r++)n+=s(e,t.slice(1)),r<t[0]-1&&(n+=","),n+="\n";return"["+n.replace(/NaN/g,"null")+"]"};return a.dataToJSON=function(e){var t=e.split(/\n-+\w*\n/),n=(t[0],t[1]),r=n.trim().split("\n\n");return r=r.map(function(e){var t=e.split("\n"),n=t.shift(),r=n.split("["),a=r.shift().split(".").pop();r=r.map(function(e){return e.slice(0,e.length-1)});var i=s(t,r);return'"'+a+'":'+i}),"{"+r.join(",\n")+"}"},a.parseData=function(e,t,n){var r=JSON.parse(a.dataToJSON(e));if(t&&r.time&&t.variables.time){var i=t.variables.time.epoch;r.time=r.time.map(function(e){if("days"===t.variables.time.scale){var n=new Date(i);return n.setDate(n.getDate()+e),n}return"seconds"===t.variables.time.scale?new Date(i.getTime()+1e3*e):null})}if(t)for(var l in r)void 0!==n&&void 0!==n[l]?a.replaceValues(r[l],n[l],0/0):t.variables[l]&&t.variables[l]._FillValue&&a.replaceValues(r[l],+t.variables[l]._FillValue,0/0);return r},a.replaceValues=function(e,t,n){for(var r in e)null===e[r]&&(e[r]=0/0),e[r].length?a.replaceValues(e[r],t,n):e[r]===t&&(e[r]=n)},a.simplifyVariable=function(e){return"[object Array]"===Object.prototype.toString.call(e)?1===e.length?a.simplifyVariable(e[0]):e.map(function(e){return a.simplifyVariable(e)}):e},a.simplify=function(e){var t={};for(var n in e)t[n]=a.simplifyVariable(e[n]);return t},a.sliceToQuery=function(e){return e.length||(e=[e]),1===e.length&&(e=[e,e]),2===e.length&&(e=[e[0],1,e[1]]),"["+e.join(":")+"]"},a.makeQuery=function(e,t,n){n=n||{};var r=e.variables[t];return r.dimensions.map(function(e){var t=e.name,r=n[t];return void 0===r&&(r=[0,+e.size-1]),a.sliceToQuery(r)}).join("")},a}("dap")}();