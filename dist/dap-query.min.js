!function(){"use strict";!function(t){var e="undefined"!=typeof window?window:global,r=Object.prototype.hasOwnProperty.call(e,t),n=e[t],i=e[t]={};"undefined"!=typeof module&&module.exports&&(module.exports=i),i.noConflict=function(){if(e[t]===i&&(e[t]=r?n:void 0,!r))try{delete e[t]}catch(a){}return i};var a=function(t){if(t.variables.time&&t.variables.time.units){var e=t.variables.time;if(0===e.units.indexOf("days since ")){var r=e.units.substr(11),n=r.split(/[ \-\:]/);e.epoch=new Date(n[0],n[1]-1,n[2],n[3],n[4],n[5])}}};i.dasToJSON=function(t){t="{\n"+t+"\n}";var e=t.split("\n").map(Function.prototype.call,String.prototype.trim),r=function(t){if(t===e.length-1)return!0;for(var r=t+1;r<e.length;r++){if("}"===e[r])return!0;if(e[r].length)return!1}return!0};e=e.map(function(t,e){if(!t.length)return"";if("{"===t)return"{";if("}"===t[0])return r(e)?"}":"},";var n;if("{"===t[t.length-1])return n=t.split(" "),'"'+n[0]+'":{';n=t.split(" ");var i=n[0],a=n[1],o=i.length+a.length+2,u=t.substr(o,t.length-o-1);"String"!==i&&u.indexOf(",")>=0&&(u="["+u+"]");var l='"'+a+'":'+u;return r(e)||(l+=","),l});var n=e.join("\n");return n},i.parseDAS=function(t){var e={variables:{}},r=i.dasToJSON(t),n=JSON.parse(r).Attributes;for(var o in n)"NC_GLOBAL"===o?e.attr=n[o]:e.variables[o]=n[o];return a(e),e};var o=function(t,e){for(var r in t)e[r]=t[r];return e},u=function(t){for(var e={},r=t.getElementsByTagName("Attribute"),n=0;n<r.length;n++){var i=r[n],a=i.getElementsByTagName("value")[0].textContent;e[i.getAttribute("name")]=a}return e},l=function(t){var e={};e.dimensions=[],e=o(u(t),e);for(var r=0;r<t.childNodes.length;r++){var n=t.childNodes[r];"Attribute"!==n.nodeName&&"#text"!==n.nodeName&&("dimension"===n.nodeName?e.dimensions.push({name:n.getAttribute("name"),size:n.getAttribute("size")}):e.dType=n.nodeName)}return e};i.parseDDX=function(t){var e=new DOMParser,r=e.parseFromString(t,"text/xml");r=r.documentElement;var n,i,s,f={variables:{}},m=r.getElementsByTagName("Grid");for(n=0;n<m.length;n++){var p=m[n];i=p.getAttribute("name"),s={},s=o(u(p),s);var v=p.getElementsByTagName("Array")[0];s=o(l(v),s),f.variables[i]=s}var c=r.getElementsByTagName("Array");for(n=0;n<c.length;n++){var g=c[n];"Grid"!==g.parentNode.nodeName&&(i=g.getAttribute("name"),f.variables[i]=l(g))}return a(f),f};var s=function(t,e){if(1===e.length)return"["+t[0]+"]";if(2===e.length)return"["+t.splice(0,e[0]).map(function(t){var e=t.split(",");return"["===e[0][0]&&e.shift(),"["+e.join(",")+"]"}).join(",\n")+"]\n";for(var r="",n=0;n<e[0];n++)r+=s(t,e.slice(1)),n<e[0]-1&&(r+=","),r+="\n";return"["+r.replace(/NaN/g,"null")+"]"};return i.dataToJSON=function(t){var e=t.split(/\n-+\w*\n/),r=(e[0],e[1]),n=r.trim().split("\n\n");return n=n.map(function(t){var e=t.split("\n"),r=e.shift(),n=r.split("["),i=n.shift().split(".").pop();n=n.map(function(t){return t.slice(0,t.length-1)});var a=s(e,n);return'"'+i+'":'+a}),"{"+n.join(",\n")+"}"},i.parseData=function(t,e){var r=JSON.parse(i.dataToJSON(t));if(e&&r.time&&e.variables.time){var n=e.variables.time.epoch;r.time=r.time.map(function(t){var e=new Date(n);return e.setDate(e.getDate()+t),e})}return r},i.simplifyVariable=function(t){return"[object Array]"===Object.prototype.toString.call(t)?1===t.length?i.simplifyVariable(t[0]):t.map(function(t){return i.simplifyVariable(t)}):t},i.simplify=function(t){var e={};for(var r in t)e[r]=i.simplifyVariable(t[r]);return e},i}("dap")}();