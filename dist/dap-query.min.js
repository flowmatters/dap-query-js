!function(){"use strict";!function(e){var t="undefined"!=typeof window?window:global,r=Object.prototype.hasOwnProperty.call(t,e),n=t[e],a=t[e]={};"undefined"!=typeof module&&module.exports&&(module.exports=a),a.noConflict=function(){if(t[e]===a&&(t[e]=r?n:void 0,!r))try{delete t[e]}catch(i){}return a};var i=function(e){if(e.variables.time&&e.variables.time.units){var t=e.variables.time;if(0===t.units.indexOf("days since ")){var r=t.units.substr(11),n=r.split(/[ \-\:]/);t.epoch=new Date(n[0],n[1]-1,n[2],n[3],n[4],n[5])}}};a.dasToJSON=function(e){e="{\n"+e+"\n}";var t=e.split("\n").map(Function.prototype.call,String.prototype.trim),r=function(e){if(e===t.length-1)return!0;for(var r=e+1;r<t.length;r++){if("}"===t[r])return!0;if(t[r].length)return!1}return!0};t=t.map(function(e,t){if(!e.length)return"";if("{"===e)return"{";if("}"===e[0])return r(t)?"}":"},";var n;if("{"===e[e.length-1])return n=e.split(" "),'"'+n[0]+'":{';n=e.split(" ");var a=n[0],i=n[1],l=a.length+i.length+2,o=e.substr(l,e.length-l-1);"String"!==a&&o.indexOf(",")>=0&&(o="["+o+"]");var u='"'+i+'":'+o;return r(t)||(u+=","),u});var n=t.join("\n");return n},a.parseDAS=function(e){var t={variables:{}},r=a.dasToJSON(e),n=JSON.parse(r).Attributes;for(var l in n)"NC_GLOBAL"===l?t.attr=n[l]:t.variables[l]=n[l];return i(t),t};var l=function(e,t){for(var r in e)t[r]=e[r];return t},o=function(e){for(var t={},r=e.getElementsByTagName("Attribute"),n=0;n<r.length;n++){var a=r[n],i=a.getElementsByTagName("value")[0].textContent;t[a.getAttribute("name")]=i}return t},u=function(e){var t={};t.dimensions=[],t=l(o(e),t);for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];"Attribute"!==n.nodeName&&"#text"!==n.nodeName&&("dimension"===n.nodeName?t.dimensions.push({name:n.getAttribute("name"),size:n.getAttribute("size")}):t.dType=n.nodeName)}return t};a.parseDDX=function(e){var t=new DOMParser,r=t.parseFromString(e,"text/xml");r=r.documentElement;var n,a,s,f={variables:{}},p=r.getElementsByTagName("Grid");for(n=0;n<p.length;n++){var v=p[n];a=v.getAttribute("name"),s={},s=l(o(v),s);var m=v.getElementsByTagName("Array")[0];s=l(u(m),s),f.variables[a]=s}var c=r.getElementsByTagName("Array");for(n=0;n<c.length;n++){var g=c[n];"Grid"!==g.parentNode.nodeName&&(a=g.getAttribute("name"),f.variables[a]=u(g))}return i(f),f};var s=function(e,t){if(1===t.length)return"["+e[0]+"]";if(2===t.length)return"["+e.splice(0,t[0]).map(function(e){var t=e.split(",");return"["===t[0][0]&&t.shift(),"["+t.join(",")+"]"}).join(",\n")+"]\n";for(var r="",n=0;n<t[0];n++)r+=s(e,t.slice(1)),n<t[0]-1&&(r+=","),r+="\n";return"["+r.replace(/NaN/g,"null")+"]"};return a.dataToJSON=function(e){var t=e.split(/\n-+\w*\n/),r=(t[0],t[1]),n=r.trim().split("\n\n");return n=n.map(function(e){var t=e.split("\n"),r=t.shift(),n=r.split("["),a=n.shift().split(".").pop();n=n.map(function(e){return e.slice(0,e.length-1)});var i=s(t,n);return'"'+a+'":'+i}),"{"+n.join(",\n")+"}"},a.parseData=function(e,t){var r=JSON.parse(a.dataToJSON(e));if(t&&r.time&&t.variables.time){var n=t.variables.time.epoch;r.time=r.time.map(function(e){var t=new Date(n);return t.setDate(t.getDate()+e),t})}if(t)for(var i in r)t.variables[i]&&t.variables[i]._FillValue&&a.replaceValues(r[i],+t.variables[i]._FillValue,0/0);return r},a.replaceValues=function(e,t,r){for(var n in e)e[n].length?a.replaceValues(e[n],t,r):e[n]===t&&(e[n]=r)},a.simplifyVariable=function(e){return"[object Array]"===Object.prototype.toString.call(e)?1===e.length?a.simplifyVariable(e[0]):e.map(function(e){return a.simplifyVariable(e)}):e},a.simplify=function(e){var t={};for(var r in e)t[r]=a.simplifyVariable(e[r]);return t},a}("dap")}();