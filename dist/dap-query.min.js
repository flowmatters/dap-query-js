!function(){"use strict";!function(e){var t="undefined"!=typeof window?window:global,n=Object.prototype.hasOwnProperty.call(t,e),r=t[e],i=t[e]={};"undefined"!=typeof module&&module.exports&&(module.exports=i),i.noConflict=function(){if(t[e]===i&&(t[e]=n?r:void 0,!n))try{delete t[e]}catch(a){}return i};var a=function(e){if(e.variables.time&&e.variables.time.units){var t=e.variables.time;if(0===t.units.indexOf("days since ")||0===t.units.indexOf("seconds since ")){t.scale=t.units.split(" ")[0];var n=t.units.substr(t.scale.length+7),r=n.split(/[ \-\:]/);t.epoch=new Date(r[0],r[1]-1,r[2],r[3]||null,r[4]||null,r[5]||null)}}};i.dasToJSON=function(e){e="{\n"+e+"\n}";var t=e.split("\n").map(Function.prototype.call,String.prototype.trim),n=function(e){if(e===t.length-1)return!0;for(var n=e+1;n<t.length;n++){if("}"===t[n])return!0;if(t[n].length)return!1}return!0};t=t.map(function(e,t){if(!e.length)return"";if("{"===e)return"{";if("}"===e[0])return n(t)?"}":"},";var r;if("{"===e[e.length-1])return r=e.split(" "),'"'+r[0]+'":{';r=e.split(" ");var i=r[0],a=r[1],l=i.length+a.length+2,s=e.substr(l,e.length-l-1);"String"!==i&&s.indexOf(",")>=0&&(s="["+s+"]");var u='"'+a+'":'+s;return n(t)||(u+=","),u});var r=t.join("\n");return r},i.parseDAS=function(e){var t={variables:{}},n=i.dasToJSON(e),r=JSON.parse(n).Attributes;for(var l in r)"NC_GLOBAL"===l?t.attr=r[l]:t.variables[l]=r[l];return a(t),t};var l=function(e,t){for(var n in e)t[n]=e[n];return t},s=function(e){for(var t={},n=e.getElementsByTagName("Attribute"),r=0;r<n.length;r++){var i=n[r],a=i.getElementsByTagName("value")[0].textContent;t[i.getAttribute("name")]=a}return t},u=function(e){var t={};t.dimensions=[],t=l(s(e),t);for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];"Attribute"!==r.nodeName&&"#text"!==r.nodeName&&("dimension"===r.nodeName?t.dimensions.push({name:r.getAttribute("name"),size:r.getAttribute("size")}):t.dType=r.nodeName)}return t};i.parseDDX=function(e){var t=new DOMParser,n=t.parseFromString(e,"text/xml");n=n.documentElement;var r,i,o,f={variables:{}},v=n.getElementsByTagName("Grid");for(r=0;r<v.length;r++){var c=v[r];i=c.getAttribute("name"),o={},o=l(s(c),o);var m=c.getElementsByTagName("Array")[0];o=l(u(m),o),f.variables[i]=o}var p=n.getElementsByTagName("Array");for(r=0;r<p.length;r++){var d=p[r];"Grid"!==d.parentNode.nodeName&&(i=d.getAttribute("name"),f.variables[i]=u(d))}return a(f),f};var o=function(e,t){if(1===t.length)return"["+e[0]+"]";if(2===t.length)return"["+e.splice(0,t[0]).map(function(e){var t=e.split(",");return"["===t[0][0]&&t.shift(),"["+t.join(",")+"]"}).join(",\n")+"]\n";for(var n="",r=0;r<t[0];r++)n+=o(e,t.slice(1)),r<t[0]-1&&(n+=","),n+="\n";return"["+n.replace(/NaN/g,"null")+"]"};return i.dataToJSON=function(e){var t=e.split(/\n-+\w*\n/),n=(t[0],t[1]),r=n.trim().split("\n\n");return r=r.map(function(e){var t=e.split("\n"),n=t.shift(),r=n.split("["),i=r.shift().split(".").pop();r=r.map(function(e){return e.slice(0,e.length-1)});var a=o(t,r);return'"'+i+'":'+a}),"{"+r.join(",\n")+"}"},i.parseData=function(e,t,n){var r=JSON.parse(i.dataToJSON(e));if(t&&r.time&&t.variables.time){var a=t.variables.time.epoch;r.time=r.time.map(function(e){if("days"===t.variables.time.scale){var n=new Date(a);return n.setDate(n.getDate()+e),n}return"seconds"===t.variables.time.scale?new Date(a.getTime()+1e3*e):null})}if(t)for(var l in r)void 0!==n&&void 0!==n[l]?i.replaceValues(r[l],n[l],0/0):t.variables[l]&&t.variables[l]._FillValue&&i.replaceValues(r[l],+t.variables[l]._FillValue,0/0);return r},i.replaceValues=function(e,t,n){for(var r in e)null===e[r]&&(e[r]=0/0),e[r].length?i.replaceValues(e[r],t,n):e[r]===t&&(e[r]=n)},i.simplifyVariable=function(e){return"[object Array]"===Object.prototype.toString.call(e)?1===e.length?i.simplifyVariable(e[0]):e.map(function(e){return i.simplifyVariable(e)}):e},i.simplify=function(e){var t={};for(var n in e)t[n]=i.simplifyVariable(e[n]);return t},i.sliceToQuery=function(e){return e.length||(e=[e]),1===e.length&&(e=[e,e]),2===e.length&&(e=[e[0],1,e[1]]),"["+e.join(":")+"]"},i.makeQuery=function(e,t,n){n=n||{};var r=e.variables[t];return r.dimensions.map(function(e){var t=e.name,r=n[t];return void 0===r&&(r=[0,+e.size-1]),i.sliceToQuery(r)}).join("")},i}("dap")}();