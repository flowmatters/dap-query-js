!function(){"use strict";!function(t){var e="undefined"!=typeof window?window:global,n=Object.prototype.hasOwnProperty.call(e,t),r=e[t],a=e[t]={};"undefined"!=typeof module&&module.exports&&(module.exports=a),a.noConflict=function(){if(e[t]===a&&(e[t]=n?r:void 0,!n))try{delete e[t]}catch(i){}return a};var i=function(t){if(t.variables.time&&t.variables.time.units){var e=t.variables.time;if(0===e.units.indexOf("days since ")){var n=e.units.substr(11),r=n.split(/[ \-\:]/);e.epoch=new Date(r[0],r[1]-1,r[2],r[3],r[4],r[5])}}};a.dasToJSON=function(t){t="{\n"+t+"\n}";var e=t.split("\n").map(Function.prototype.call,String.prototype.trim),n=function(t){if(t===e.length-1)return!0;for(var n=t+1;n<e.length;n++){if("}"===e[n])return!0;if(e[n].length)return!1}return!0};e=e.map(function(t,e){if(!t.length)return"";if("{"===t)return"{";if("}"===t[0])return n(e)?"}":"},";var r;if("{"===t[t.length-1])return r=t.split(" "),'"'+r[0]+'":{';r=t.split(" ");var a=r[0],i=r[1],o=a.length+i.length+2,u=t.substr(o,t.length-o-1);"String"!==a&&u.indexOf(",")>=0&&(u="["+u+"]");var s='"'+i+'":'+u;return n(e)||(s+=","),s});var r=e.join("\n");return r},a.parseDAS=function(t){var e={variables:{}},n=a.dasToJSON(t),r=JSON.parse(n).Attributes;for(var o in r)"NC_GLOBAL"===o?e.attr=r[o]:e.variables[o]=r[o];return i(e),e};var o=function(t,e){for(var n in t)e[n]=t[n];return e},u=function(t){for(var e={},n=t.getElementsByTagName("Attribute"),r=0;r<n.length;r++){var a=n[r],i=a.getElementsByTagName("value")[0].textContent;e[a.getAttribute("name")]=i}return e},s=function(t){var e={};e.dimensions=[],e=o(u(t),e);for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];"Attribute"!==r.nodeName&&"#text"!==r.nodeName&&("dimension"===r.nodeName?e.dimensions.push({name:r.getAttribute("name"),size:r.getAttribute("size")}):e.dType=r.nodeName)}return e};a.parseDDX=function(t){var e=new DOMParser,n=e.parseFromString(t,"text/xml");n=n.documentElement;var r,a,l,f={variables:{}},m=n.getElementsByTagName("Grid");for(r=0;r<m.length;r++){var v=m[r];a=v.getAttribute("name"),l={},l=o(u(v),l);var p=v.getElementsByTagName("Array")[0];l=o(s(p),l),f.variables[a]=l}var c=n.getElementsByTagName("Array");for(r=0;r<c.length;r++){var d=c[r];"Grid"!==d.parentNode.nodeName&&(a=d.getAttribute("name"),f.variables[a]=s(d))}return i(f),f};var l=function(t,e){if(1===e.length)return"["+t[0]+"]";if(2===e.length)return"["+t.splice(0,e[0]).map(function(t){var e=t.split(",");return"["===e[0][0]&&e.shift(),"["+e.join(",")+"]"}).join(",\n")+"]\n";for(var n="",r=0;r<e[0];r++)n+=l(t,e.slice(1)),r<e[0]-1&&(n+=","),n+="\n";return"["+n+"]"};return a.dataToJSON=function(t){var e=t.split(/\n-+\w*\n/),n=(e[0],e[1]),r=n.trim().split("\n\n");return r=r.map(function(t){var e=t.split("\n"),n=e.shift(),r=n.split("["),a=r.shift().split(".").pop();r=r.map(function(t){return t.slice(0,t.length-1)});var i=l(e,r);return'"'+a+'":'+i}),"{"+r.join(",\n")+"}"},a.parseData=function(t,e){var n=JSON.parse(a.dataToJSON(t));if(e&&n.time&&e.variables.time){var r=e.variables.time.epoch;n.time=n.time.map(function(t){var e=new Date(r);return e.setDate(e.getDate()+t),e})}return n},a}("dap")}();